!function t(e,n,i){function r(a,s){if(!n[a]){if(!e[a]){var u="function"==typeof require&&require;if(!s&&u)return u(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};e[a][0].call(l.exports,function(t){var n=e[a][1][t];return r(n?n:t)},l,l.exports,t,e,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function r(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e["default"]=t,e}function o(){return M?setTimeout(o,1e3/60):(E.setTargets(),E.fire(),E.collision(),E.getUnits().forEach(function(t){t.move()}),void setTimeout(o,1e3/60))}function a(){var t={layer:v};v.clearRect(0,0,1e3,1e3),f.renderMap(m.map,t),f.renderUnits(E.getUnits(),t),f.renderStats(E.getStats(),t),S&&f.renderCursor(S,s({},t,E.buildAtributes(S,w.get()))),y(a)}var s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t},u=t("./maps"),c=t("./objects"),l=r(c),f=t("./core/render"),h=(t("./core/utils"),t("./core/game")),g=i(h),d=t("./core/mouse"),p=i(d),m=(t("./core/constants"),u.getFirst()),y=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},x=document.querySelector("canvas"),v=x.getContext("2d"),w=p["default"](v),_=Object.keys(l).map(function(t){return l[t]}).filter(function(t){return"tower"===t.type});v.imageSmoothingEnabled=!1,x.width=640,x.height=320;var E=g["default"](m),M=!1,S=null;E.run(),f.renderPanel(document.querySelector("[data-panel]")),document.addEventListener("visibilitychange",function(t){return M=document.hidden}),document.addEventListener("contextmenu",function(t){t.preventDefault(),S=null}),_.forEach(function(t){document.querySelector('[data-tower="'+t.name+'"]').addEventListener("click",function(e){S=t})}),x.addEventListener("click",function(t){var e;if(S){if(e=E.buildAtributes(S,w.get()),!e.alowed)return;E.buildTower(S,e)}}),f.preloadAll(function(){o(),a()})},{"./core/constants":4,"./core/game":5,"./core/mouse":6,"./core/render":7,"./core/utils":8,"./maps":10,"./objects":14}],2:[function(t,e,n){"use strict";function i(t,e){var n=e.x,i=e.y,o=e.target;this.config=t,this.x=n,this.y=i,this.createdAt=Date.now(),this.lastShotAt=0,this.alive=!0,this.health=t.health,this.target=o||null,this.path=null,this.angle=o?r.getAngle(this,o):0}n.__esModule=!0;var r=t("./utils");i.prototype.move=function(){this.config.homing&&this.target?this.angle=r.getAngle(this,this.target):this.path&&(this.angle=r.getAngle(this,this.path[0]),r.round(this.x-this.path[0].x,5)||r.round(this.y-this.path[0].y,5)||(this.path=this.path.slice(1),this.path.length||(this.path=null))),this.x+=this.config.movementSpeed*Math.cos(this.angle),this.y+=this.config.movementSpeed*Math.sin(this.angle)},i.prototype.setPath=function(t){this.path=t},i.prototype.setTarget=function(t){this.target=t},i.prototype.takeDamage=function(t){this.health-=t,this.health<=0&&this.die()},i.prototype.fire=function(){var t=1e3/this.config.attackSpeed,e=Date.now();return this.target&&this.lastShotAt+t<e?(this.lastShotAt=e,!0):null},i.prototype.die=function(){this.alive=!1,this.health=0},n["default"]=i,e.exports=n["default"]},{"./utils":8}],3:[function(t,e,n){"use strict";function i(t,e,n){var r=n[o(e)];return r=r.x===t.x&&r.y===t.y?r:i(t,r,n),[e].concat(r)}function r(t,e,n){for(var r,a,s,u,c,l,f,h,g=[t],d={},p={},m={},y=(r={},r[o(t)]=0,r),x=n[0].length,v=n.length;g.length;){if(s=g.shift(),s.x===e.x&&s.y===e.y)return i(t,e,m).reverse();for(l=o(s),u=y[l],d[l]=!0,f=[{x:s.x-1,y:s.y},{x:s.x+1,y:s.y},{x:s.x,y:s.y-1},{x:s.x,y:s.y+1}],a=0;4>a;a++)h=f[a],l=o(h),p[l]||h.x<0||h.x>=x||h.y<0||h.y>=v||n[h.y][h.x]||(c=u+1,(!(l in y)||c<y[l])&&(y[l]=c,m[l]=s),p[l]=!0,g.push(h))}return null}n.__esModule=!0,n["default"]=r;var o=function(t){return t.x+","+t.y};Math.abs;e.exports=n["default"]},{}],4:[function(t,e,n){"use strict";n.__esModule=!0;var i=32;n.SEGMENT=i},{}],5:[function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function r(t){function e(t){return{x:Math.floor(t.x/s.SEGMENT),y:Math.floor(t.y/s.SEGMENT)}}function n(){k.forEach(i)}function i(n){var i=c["default"](e(n),t.finish,F).slice(1).map(function(t){return{x:t.x*s.SEGMENT,y:t.y*s.SEGMENT}});n.setPath(i)}function r(t,i){var r=e(i);N.push(new a["default"](t,i)),F[r.y][r.x]=1,D={},T-=t.price,n()}function o(t,e){var n=new a["default"](t,e);k.push(n),i(n)}function u(){return N.concat(k).concat(G).concat(j)}function f(){var t,e,n,i,r,o,a;for(t=0;t<N.length;t++){if(n=N[t],i=n.target){if(l.inRange(n,i))continue;n.setTarget(null)}for(o=1/0,r=null,e=0;e<k.length;e++)i=k[e],a=l.inRangeDiff(n,i),0>a&&o>a&&(r=i,o=a),r&&n.setTarget(r)}}function h(){var t,e;for(t=0;t<N.length;t++)e=N[t],e.fire()&&G.push(new a["default"](e.config.shot,{x:e.x,y:e.y,target:e.target,angle:l.getAngle(e,e.target)}))}function g(){var t,e,n;for(t=0;t<G.length;t++)if(n=G[t],n.config.homing&&n.target&&l.inObject(n,n.target))d(n,n.target);else if(!n.config.homing)for(e=0;e<k.length;e++)if(l.inObject(n,k[e])){d(n,k[e]);break}for(m(),t=0;t<k.length;t++)l.inObject(k[t],O)&&(S--,k[t].die());m()}function d(t,e){var n;if(t.config.splash)for(n=0;n<k.length;n++)l.inSplash(t,k[n])&&p(t,k[n]);else p(t,e);t.die(),t.config.death&&j.push(new a["default"](t.config.death,{x:t.x,y:t.y}))}function p(t,e){e.takeDamage(t.config.damage)}function m(){var t,e=Date.now(),n=[];for(t=0;t<k.length;t++)k[t].alive?n.push(k[t]):y(k[t]);G=G.filter(function(t){return t.alive}),j=j.filter(function(t){return t.config.corpse||60*t.config.textures.length+t.createdAt>e}),k=n}function y(t){var e;for(e=0;e<N.length;e++)N[e].target===t&&N[e].setTarget(null);T+=t.config.bounty,A--,A||(M++,setTimeout(w,5e3))}function x(e){var n,i=e.x+","+e.y;return D[i]?D[i]:(n=F.slice(),n[e.y]=F[e.y].slice(),n[e.y][e.x]=1,D[i]=!!c["default"](t.spawn,t.finish,n),D[i])}function v(n,i){var r,o=k.concat(N),a=e(i),u=a.x*s.SEGMENT,c=a.y*s.SEGMENT,f={x:u,y:c,config:n};if(n.price>T)return{x:u,y:c,alowed:!1};for(r=0;r<o.length;r++)if(l.isOverlap(o[r],f))return{x:u,y:c,alowed:!1};return a.x<0||a.x>=t.size.width||a.y<0||a.y>=t.size.height?{x:u,y:c,alowed:!1}:{x:u,y:c,alowed:x(a)}}function w(){function e(){i>=n.count||(o(n.unit,{x:t.spawn.x*s.SEGMENT,y:t.spawn.y*s.SEGMENT}),i++,setTimeout(e,3e3))}if(M>=t.waves.length)return console.log("END GAME");var n=t.waves[M],i=0;A=n.count,e()}function _(){w()}function E(){return{wave:M+1,lives:S,score:b,gold:T,unitsInWave:A}}var M=0,S=t.lives,T=t.gold,b=0,A=0,N=[],k=[],G=[],j=[],O=({x:0,y:0,config:{width:t.size.width*s.SEGMENT,height:t.size.height*s.SEGMENT}},{x:t.finish.x*s.SEGMENT,y:t.finish.y*s.SEGMENT,config:{width:s.SEGMENT,height:s.SEGMENT}}),F=new Array(t.size.height).join().split(",").map(function(e){return new Array(t.size.width).join().split(",").map(Number)}),D={};return{buildTower:r,addUnit:o,getUnits:u,setTargets:f,fire:h,collision:g,buildAtributes:v,run:_,getStats:E}}n.__esModule=!0,n["default"]=r;var o=t("./Unit"),a=i(o),s=t("./constants"),u=t("./algorithms/astar"),c=i(u),l=t("./utils");e.exports=n["default"]},{"./Unit":2,"./algorithms/astar":3,"./constants":4,"./utils":8}],6:[function(t,e,n){"use strict";n.__esModule=!0,n["default"]=function(t){var e=0,n=0;return t.canvas.addEventListener("mousemove",function(t){e=t.clientX,n=t.clientY}),{get:function(){return{x:e,y:n}}}},e.exports=n["default"]},{}],7:[function(t,e,n){"use strict";function i(t,e){function n(){var e=u/t.health;o.imageSmoothingEnabled=!1,o.drawImage(h,i,r,t.width,t.height),o.globalAlpha=1,"health"in t&&(o.fillStyle="#00FF00",o.fillRect(i,r,t.width,2),o.fillStyle="#FF0000",o.fillRect(i+e*t.width,r,(1-e)*t.width,2))}var i=e.x,r=e.y,o=e.layer,a=e.time,s=void 0===a?0:a,u=e.health,c=t.fastAnimation?d:g,l=~~((Date.now()-s)/c)%t.textures.length,f=t.textures[l],h=m[f];h||(h=m[f]=new Image,h.src=f,h.loads=[],h.onload=function(){h.loads.forEach(function(t){return t()})}),h.complete?n():h.loads.push(n)}function r(t,e){var n=e.layer;t.forEach(function(t,e){t.forEach(function(t,r){var o={x:h.SEGMENT*r,y:h.SEGMENT*e,layer:n};i(t,o)})})}function o(t,e){var n=e.x,r=e.y,o=e.layer,a=e.alowed;o.globalAlpha=.4,o.fillStyle=a?"#00FF00":"#FF0000",o.fillRect(n,r,h.SEGMENT,h.SEGMENT),i(t,{layer:o,x:n,y:r})}function a(t,e){var n=e.layer;t.forEach(function(t){i(t.config,{layer:n,x:t.x,y:t.y,health:t.health,time:t.createdAt})})}function s(t,e){var n=e.layer,i=e.x,r=e.y;n.strokeStyle="black",n.font="16px monaco",n.lineWidth=4,n.strokeText(t,i,r),n.fillStyle="white",n.fillText(t,i,r)}function u(t,e){var n=e.layer;s("wave:  "+t.wave,{x:10,y:20,layer:n}),s("lives: "+t.lives,{x:10,y:40,layer:n}),s("gold:  "+t.gold,{x:10,y:60,layer:n}),s("score: "+t.score,{x:10,y:80,layer:n})}function c(t){Object.keys(p).map(function(t){return p[t]}).filter(function(t){return"tower"===t.type}).forEach(function(e){var n=document.createElement("img");n.src=e.textures[0],n.classList.add("panel-tower"),n.dataset.tower=e.name,n.width=e.width,n.height=e.height,t.appendChild(n)})}function l(t,e){var n=t.reduce(function(t,e){return t.concat(e.textures)},[]).filter(Boolean);Promise.all(n.map(function(t){return new Promise(function(e){var n=new Image;m[t]=n,n.onload=e,n.loads=[],n.src=t})})).then(e)}function f(t){var e=Object.keys(p).map(function(t){return p[t]});return l(e,t)}n.__esModule=!0,n.render=i,n.renderMap=r,n.renderCursor=o,n.renderUnits=a,n.renderStats=u,n.renderPanel=c,n.preload=l,n.preloadAll=f;var h=t("./constants"),g=300,d=60,p=t("../objects"),m=[]},{"../objects":14,"./constants":4}],8:[function(t,e,n){"use strict";function i(t,e){return r(t,e)<0}function r(t,e){return f(e.x-t.x)+f(e.y-t.y)-f(t.config.range)}function o(t,e){var n=e.x-t.x,i=e.y-t.y,r=Math.atan(i/n);return 0>n&&(r=Math.PI+r),r}function a(t,e){var n=t.config?t.config.width/2:0,i=t.config?t.config.height/2:0;return t.x>=e.x-n&&t.x<e.x+e.config.width+n&&t.y>=e.y-i&&t.y<e.y+e.config.height+i}function s(t,e){return(t.x>=e.x&&t.x<e.x+e.config.width||t.x+t.config.width>e.x&&t.x+t.config.width<e.x+e.config.width)&&(t.y>=e.y&&t.y<e.y+e.config.height||t.y+t.config.height>e.y&&t.y+t.config.height<e.y+e.config.height)}function u(t,e){return f(t.x-e.x-e.config.width/2)+f(t.y-e.y-e.config.height/2)<f(t.config.splash)}function c(t,e){return Math.round(Math.random()*(e-t))+t}function l(t){var e=arguments.length<=1||void 0===arguments[1]?1:arguments[1];return t-t%e}n.__esModule=!0,n.inRange=i,n.inRangeDiff=r,n.getAngle=o,n.inObject=a,n.isOverlap=s,n.inSplash=u,n.random=c,n.round=l;var f=(Math.sqrt,function(t){return t*t})},{}],9:[function(t,e,n){"use strict";n.__esModule=!0,n["default"]={lives:3,gold:100,size:{width:20,height:10},spawn:{x:0,y:5},finish:{x:19,y:5},waves:[[1,3],[1,20]],map:"\n	11111111111111111111\n	11111111111111111111\n	11111111111111111111\n	11111111111111111111\n	11111111111111111111\n	11111111111111111111\n	11111111111111111111\n	11111111111111111111\n	11111111111111111111\n	11111111111111111111\n	"},e.exports=n["default"]},{}],10:[function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}function r(t){var e=t.map.split("\n").filter(Boolean).map(function(t){return t.trim().split("").map(Number).map(function(t){return f[t]})});return e[t.spawn.y][t.spawn.x]=l.spawn,e[t.finish.y][t.finish.x]=l.spawn,e}function o(t){return t.map(function(t){return{unit:h[t[0]],count:t[1]}})}function a(){var t=c["default"];return s({},t,{map:r(t),waves:o(t.waves)})}n.__esModule=!0;var s=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t};n.getFirst=a;var u=t("./first"),c=i(u),l=t("../objects"),f={0:l.sand,1:l.grass,2:l.rock},h={1:l.unit}},{"../objects":14,"./first":9}],11:[function(t,e,n){"use strict";n.__esModule=!0,n["default"]={name:"Arrow Tower",type:"tower",textures:["images/tower_1_2.png"],width:32,height:32,movementSpeed:0,attackSpeed:2,price:10,range:250,shot:{textures:["images/shot_1.png"],damage:1,homing:!0,movementSpeed:4,width:10,height:10,death:{width:16,height:16,movementSpeed:0,corpse:0,fastAnimation:!0,textures:["images/explosion_1_1.png","images/explosion_1_2.png","images/explosion_1_3.png"]}}},e.exports=n["default"]},{}],12:[function(t,e,n){"use strict";n.__esModule=!0,n["default"]={name:"Cannon Tower",type:"tower",textures:["images/tower_2_1.png"],width:32,height:32,movementSpeed:0,attackSpeed:.3,price:60,range:250,shot:{textures:["images/shot_2.png"],damage:30,homing:!1,splash:30,movementSpeed:1.5,width:10,height:10,death:{width:18,height:18,movementSpeed:0,corpse:0,fastAnimation:!0,textures:["images/explosion_2_1.png","images/explosion_2_2.png","images/explosion_2_3.png"]}}},e.exports=n["default"]},{}],13:[function(t,e,n){"use strict";n.__esModule=!0,n["default"]={name:"Grass",textures:["images/grass_3.png"],width:32,height:32},e.exports=n["default"]},{}],14:[function(t,e,n){"use strict";function i(t){return t&&t.__esModule?t:{"default":t}}n.__esModule=!0;var r=t("./grass"),o=i(r);n.grass=o["default"];var a=t("./sand"),s=i(a);n.sand=s["default"];var u=t("./rock"),c=i(u);n.rock=c["default"];var l=t("./spawn"),f=i(l);n.spawn=f["default"];var h=t("./arrowTower"),g=i(h);n.arrowTower=g["default"];var d=t("./cannonTower"),p=i(d);n.cannonTower=p["default"];var m=t("./unit"),y=i(m);n.unit=y["default"]},{"./arrowTower":11,"./cannonTower":12,"./grass":13,"./rock":15,"./sand":16,"./spawn":17,"./unit":18}],15:[function(t,e,n){"use strict";n.__esModule=!0,n["default"]={name:"Rock",textures:["images/rock.png"],width:32,height:32},e.exports=n["default"]},{}],16:[function(t,e,n){"use strict";n.__esModule=!0,n["default"]={name:"Sand",textures:["images/sand.png"],width:32,height:32},e.exports=n["default"]},{}],17:[function(t,e,n){"use strict";n.__esModule=!0,n["default"]={name:"Spawn",textures:["images/spawn_1.png","images/spawn_2.png"],width:32,height:32},e.exports=n["default"]},{}],18:[function(t,e,n){"use strict";n.__esModule=!0,n["default"]={name:"Unit",type:"unit",textures:["images/unit_1_1.png","images/unit_1_2.png"],width:18,height:32,movementSpeed:.6,bounty:3,health:100,damage:0},e.exports=n["default"]},{}]},{},[1]);