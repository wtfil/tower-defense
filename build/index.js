!function t(e,i,s){function n(r,o){if(!i[r]){if(!e[r]){var h="function"==typeof require&&require;if(!o&&h)return h(r,!0);if(a)return a(r,!0);var u=new Error("Cannot find module '"+r+"'");throw u.code="MODULE_NOT_FOUND",u}var l=i[r]={exports:{}};e[r][0].call(l.exports,function(t){var i=e[r][1][t];return n(i?i:t)},l,l.exports,t,e,i,s)}return i[r].exports}for(var a="function"==typeof require&&require,r=0;r<s.length;r++)n(s[r]);return n}({1:[function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{"default":t}}var n=t("./core/TowerDefense"),a=s(n),r=new Phaser.Game(704,320,Phaser.AUTO);r.state.add("Game",a["default"],!0)},{"./core/TowerDefense":5}],2:[function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}i.__esModule=!0;var r=t("./utils"),o=t("./Dynamic"),h=s(o),u=function(t){function e(){n(this,e),t.apply(this,arguments)}return a(e,t),e.prototype.update=function(){var t=100*this.config.movementSpeed;this.config.homing&&this.target&&(this.angle=r.getAngle(this,this.target)),this.body.velocity.x=t*Math.cos(this.angle),this.body.velocity.y=t*Math.sin(this.angle)},e.prototype.clearTarget=function(t){this.target===t&&(this.target=null)},e.prototype.setTarget=function(t){this.target=t,this.angle=r.getAngle(this,t)},e}(h["default"]);i["default"]=u,e.exports=i["default"]},{"./Dynamic":3,"./utils":8}],3:[function(t,e,i){"use strict";function s(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}i.__esModule=!0;var a=function(t){function e(i,n,a,r){s(this,e),t.call(this,i,a,r,n.name),this.config=n,this.width=n.width,this.height=n.height,this.game.physics.startSystem(Phaser.Physics.ARCADE),this.game.add.existing(this),this.animations.add("move"),this.animations.play("move",4,!0),this.checkWorldBounds=!0,this.outOfBoundsKill=!0}return n(e,t),e}(Phaser.Sprite);i["default"]=a,e.exports=i["default"]},{}],4:[function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}i.__esModule=!0;var r=t("./Dynamic"),o=s(r),h=t("./Bullet"),u=s(h),l=t("./utils"),c=function(t){function e(){n(this,e);for(var i=arguments.length,s=Array(i),a=0;i>a;a++)s[a]=arguments[a];t.call.apply(t,[this].concat(s)),this.fireInterval=1e3/this.config.attackSpeed,this.lastShotAt=0}return a(e,t),e.prototype.setTarget=function(t){if(!this.target||!l.inRange(this,this.target)){for(var e,i,s=1/0,n=0;n<t.children.length;n++)t.children[n].exists&&(i=l.inRangeDiff(this,t.children[n]),0>=i&&s>i&&(s=i,e=t.children[n]));this.target=e||null}},e.prototype.clearTarget=function(t){this.target===t&&(this.target=null)},e.prototype.fire=function(t){var e=Date.now();if(this.target){if(this.lastShotAt+this.fireInterval>e)return null;var i=new u["default"](this.game,this.config.shot,this.x,this.y);i.setTarget(this.target),t.add(i),this.lastShotAt=e}},e}(o["default"]);i["default"]=c,e.exports=i["default"]},{"./Bullet":2,"./Dynamic":3,"./utils":8}],5:[function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}i.__esModule=!0;var a=t("../maps"),r=t("../objects"),o=t("./utils"),h=t("./algorithms/astar"),u=s(h),l=t("./Unit"),c=s(l),f=t("./Tower"),p=s(f),d=32,g={s:.25,m:.5,l:1},m=function(){function t(){n(this,t),this.map=a.getFirst()}return t.prototype.preload=function(){var t=this;this.load.image("grass","images/grass_3.png"),this.load.image("font","images/PressStart2P.png"),this.load.spritesheet("spawn","images/spawn.png",d,d),r.units.concat(r.towers).reduce(function(t,e){return t.concat(e).concat(e.shot).concat(e.shot&&e.shot.buff)},[]).filter(Boolean).forEach(function(e){e.name||console.warn("Name is missing",e),e.sprite?t.load.spritesheet(e.name,e.sprite,d,d):t.load.image(e.name,e.textures[0])})},t.prototype.addSprite=function(t,e,i){var s=this.add.sprite(t,e,i);return s.animations.add("spin"),s.animations.play("spin",4,!0),s},t.prototype.addLabel=function(t,e,i){var s=this.add.retroFont("font",32,32,Phaser.RetroFont.TEXT_SET1),n=this.add.image(t,e,s),a=g[i]||1;return n.scale.setTo(a,a),s.multiLine=!0,s},t.prototype.create=function(){var t=this,e=this.map,i=e.size,s=i.width,n=i.height,a=e.spawn,o=e.finish;this.stats={lives:this.map.lives,gold:this.map.gold,unitsToKill:0,wave:0},this.physics.startSystem(Phaser.Physics.ARCADE),this.stage.backgroundColor=16777215,this.add.tileSprite(0,0,s*d,n*d,"grass"),this.statsLabel=this.addLabel(5,5,"m"),this.start=this.addSprite(a.x*d,a.y*d,"spawn"),this.finish=this.addSprite(o.x*d,o.y*d,"spawn"),this.game.physics.arcade.enable(this.finish),this.towers=this.add.group(),this.units=this.add.physicsGroup(),this.bullets=this.add.physicsGroup(),this.towerAllowedPlacesCache={},this.mapObjects=new Array(this.map.size.height).fill().map(function(e){return new Array(t.map.size.width).fill(0)}),this.cursor=this.add.sprite(),this.cursor.tint=16711680,this.cursor.visible=!1,r.towers.forEach(function(e,i){var s=t.add.button(640,d*i,e.name,function(){return t.selectTowerToBuild(e)});s.width=d,s.height=d}),this.esc=this.game.input.keyboard.addKey(Phaser.Keyboard.ESC),this.runWave()},t.prototype.runWave=function(){this.stats.unitsToKill=this.map.waves[this.stats.wave].count,this.time.events.repeat(2e3,this.stats.unitsToKill,this.spawnUnit.bind(this))},t.prototype.spawnUnit=function(){var t=this.map.waves[this.stats.wave].unit,e=o.scale(this.map.spawn,d),i=e.x,s=e.y,n=new c["default"](this.game,t,i,s);this.units.add(n),this.updatePath(n)},t.prototype.updatePath=function(t){var e=u["default"](o.scale(t,1/d),this.map.finish,this.mapObjects).slice(1).map(function(t){return o.scale(t,d)});t.setPath(e)},t.prototype.spawnTower=function(t,e){this.isAllowToBuild(t,e)&&(this.towers.add(new p["default"](this.game,this.towerToBuild,t,e)),this.stats.gold-=this.towerToBuild.price,this.mapObjects[e/d][t/d]=1,this.towerAllowedPlacesCache={},this.units.forEachExists(this.updatePath.bind(this)))},t.prototype.isAllowToBuild=function(t,e){if(this.towerToBuild.price>this.stats.gold)return!1;var i,s=this.units.children.concat(this.towers.children),n={config:this.towerToBuild,x:t,y:e};for(i=0;i<s.length;i++)if(s[i].exists&&o.isOverlap(s[i],n))return!1;t/=d,e/=d;var a=t+","+e;if(a in this.towerAllowedPlacesCache)return this.towerAllowedPlacesCache[a];var r=this.mapObjects.slice();r[e]=this.mapObjects[e].slice(),r[e][t]=1;var h=u["default"](this.map.spawn,this.map.finish,r);return this.towerAllowedPlacesCache[a]=Boolean(h)},t.prototype.update=function(){var t=this.input.mousePointer,e=t.worldX,i=t.worldY,s=o.round(e,d),n=o.round(i,d);this.statsLabel.text=("\n			Gold  "+this.stats.gold+"\n			Lives "+this.stats.lives+"\n			Wave  "+(this.stats.wave+1)+" / "+this.map.waves.length+"\n		").trim(),this.towers.callAll("setTarget",null,this.units),this.towers.callAll("fire",null,this.bullets),this.physics.arcade.overlap(this.bullets,this.units,this.attackUnits.bind(this)),this.physics.arcade.overlap(this.finish,this.units,this.unitFinish.bind(this)),this.cursor.position.set(s,n),this.esc.isDown&&(this.cursor.visible=!1,this.towerToBuild=null),this.towerToBuild&&(this.cursor.tint=this.isAllowToBuild(s,n)?65280:16711680),this.input.activePointer.isDown&&this.towerToBuild&&this.spawnTower(s,n)},t.prototype.selectTowerToBuild=function(t){this.towerToBuild=t,this.cursor.loadTexture(t.name),this.cursor.width=d,this.cursor.height=d,this.cursor.visible=!0},t.prototype.attackUnit=function(t,e){e.takeDamage(t),t.kill(),e.exists||(this.stats.gold+=e.config.bounty,this.removeUnit(e))},t.prototype.unitFinish=function(t,e){e.kill(),this.removeUnit(e),this.stats.lives--,this.stats.lives<0&&this.game.state.start("Game")},t.prototype.removeUnit=function(t){if(this.towers.callAll("clearTarget",null,t),this.bullets.callAll("clearTarget",null,t),this.stats.unitsToKill--,0===this.stats.unitsToKill){if(this.stats.wave++,this.stats.wave>=this.map.waves.length)return this.game.state.start("Game");this.game.time.events.add(5e3,this.runWave.bind(this)).autoDestroy=!0}},t.prototype.attackUnits=function(t,e){var i=this;return t.config.splash?void this.units.forEach(function(e){o.inSplash(t,e)&&i.attackUnit(t,e)}):this.attackUnit(t,e)},t}();i["default"]=m,e.exports=i["default"]},{"../maps":10,"../objects":15,"./Tower":4,"./Unit":6,"./algorithms/astar":7,"./utils":8}],6:[function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{"default":t}}function n(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}i.__esModule=!0;var r=t("./Dynamic"),o=s(r),h=t("./utils"),u=function(t){function e(){n(this,e);for(var i=arguments.length,s=Array(i),a=0;i>a;a++)s[a]=arguments[a];t.call.apply(t,[this].concat(s)),this.health=this.config.health,this.buffs={},this.healthBar=this.game.add.graphics(0,0),this.healthBar.anchor=new Phaser.Point,this.addChild(this.healthBar)}return a(e,t),e.prototype.update=function(){this.path&&h.distance2(this,this.path[0])<10&&(this.path.length>1?(this.path=this.path.slice(1),this.angle=h.getAngle(this,this.path[0])):this.path=null),this.applyBuffs();var t=this.health/this.config.health,e=this.config.width,i=100*this.movementSpeed;this.body.velocity.x=Math.cos(this.angle)*i,this.body.velocity.y=Math.sin(this.angle)*i,this.healthBar.clear(),this.healthBar.lineStyle(2,65280,.5),this.healthBar.drawRect(0,0,e*t,2),this.healthBar.lineStyle(2,16711680,.5),this.healthBar.drawRect(e*t,0,e*(1-t),2)},e.prototype.applyBuffs=function(){var t=void 0;this.movementSpeed=this.config.movementSpeed;for(t in this.buffs){var e=this.buffs[t];e.startAt+e.config.duration<Date.now()?e.sprite.kill():e.config.effect(this)}},e.prototype.takeDamage=function(t){if(this.health-=t.config.damage,this.health<=0)return this.kill();var e=t.config.buff;if(e){if(!this.buffs[e.name]){var i=this.game.add.sprite(0,4,e.name);i.width=8,i.height=8,this.buffs[e.name]={config:e,sprite:i},this.addChild(i)}this.buffs[e.name].startAt=Date.now()}},e.prototype.setPath=function(t){this.path=t,this.angle=h.getAngle(this,t[0])},e}(o["default"]);i["default"]=u,e.exports=i["default"]},{"./Dynamic":3,"./utils":8}],7:[function(t,e,i){"use strict";function s(t,e,i){var n=i[a(e)];return n=n.x===t.x&&n.y===t.y?n:s(t,n,i),[e].concat(n)}function n(t,e,i){for(var n,r,o,h,u,l,c,f,p=[t],d={},g={},m={},w=(n={},n[a(t)]=0,n),y=i[0].length,v=i.length;p.length;){if(o=p.shift(),o.x===e.x&&o.y===e.y)return s(t,e,m).reverse();for(l=a(o),h=w[l],d[l]=!0,c=[{x:o.x-1,y:o.y},{x:o.x+1,y:o.y},{x:o.x,y:o.y-1},{x:o.x,y:o.y+1}],r=0;4>r;r++)f=c[r],l=a(f),g[l]||f.x<0||f.x>=y||f.y<0||f.y>=v||i[f.y][f.x]||(u=h+1,(!(l in w)||u<w[l])&&(w[l]=u,m[l]=o),g[l]=!0,p.push(f))}return null}i.__esModule=!0,i["default"]=n;var a=function(t){return t.x+","+t.y};Math.abs;e.exports=i["default"]},{}],8:[function(t,e,i){"use strict";function s(t,e){return n(t,e)<0}function n(t,e){return p(e.x-t.x)+p(e.y-t.y)-p(t.config.range)}function a(t,e){return p(t.x-e.x)+p(t.y-e.y)}function r(t,e){return{x:Math.floor(t.x*e),y:Math.floor(t.y*e)}}function o(t,e){var i=e.x-t.x,s=e.y-t.y,n=Math.atan(s/i);return 0>i&&(n=Math.PI+n),n}function h(t,e){var i=t.config?t.config.width/2:0,s=t.config?t.config.height/2:0;return t.x>=e.x-i&&t.x<e.x+e.config.width+i&&t.y>=e.y-s&&t.y<e.y+e.config.height+s}function u(t,e){return(t.x>=e.x&&t.x<e.x+e.config.width||t.x+t.config.width>e.x&&t.x+t.config.width<e.x+e.config.width)&&(t.y>=e.y&&t.y<e.y+e.config.height||t.y+t.config.height>e.y&&t.y+t.config.height<e.y+e.config.height)}function l(t,e){return p(t.x-e.x-e.config.width/2)+p(t.y-e.y-e.config.height/2)<p(t.config.splash)}function c(t,e){return Math.round(Math.random()*(e-t))+t}function f(t){var e=arguments.length<=1||void 0===arguments[1]?1:arguments[1];return t-t%e}i.__esModule=!0,i.inRange=s,i.inRangeDiff=n,i.distance2=a,i.scale=r,i.getAngle=o,i.inObject=h,i.isOverlap=u,i.inSplash=l,i.random=c,i.round=f;var p=(Math.sqrt,function(t){return t*t})},{}],9:[function(t,e,i){"use strict";i.__esModule=!0,i["default"]={lives:3,gold:100,size:{width:20,height:10},spawn:{x:0,y:2},finish:{x:19,y:7},waves:[[1,10],[2,10]],map:"\n	11111111111111111111\n	11111111111111111111\n	11111111111111111111\n	11111111111111111111\n	11111111111111111111\n	11111111111111111111\n	11111111111111111111\n	11111111111111111111\n	11111111111111111111\n	11111111111111111111\n	"},e.exports=i["default"]},{}],10:[function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{"default":t}}function n(t){var e=t.map.split("\n").filter(Boolean).map(function(t){return t.trim().split("").map(Number).map(function(t){return c[t]})});return e[t.spawn.y][t.spawn.x]=l.spawn,e[t.finish.y][t.finish.x]=l.spawn,e}function a(t){return t.map(function(t){return{unit:f[t[0]],count:t[1]}})}function r(){var t=u["default"];return o({},t,{map:n(t),waves:a(t.waves)})}i.__esModule=!0;var o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(t[s]=i[s])}return t};i.getFirst=r;var h=t("./first"),u=s(h),l=t("../objects"),c={0:l.sand,1:l.grass,2:l.rock},f={1:l.peasant,2:l.recruit}},{"../objects":15,"./first":9}],11:[function(t,e,i){"use strict";i.__esModule=!0,i["default"]={name:"Arrow Tower",type:"tower",textures:["images/tower_1_2.png"],width:32,height:32,movementSpeed:0,attackSpeed:5,price:20,range:250,shot:{name:"Arrow Tower Ammo",textures:["images/shot_1.png"],damage:3,homing:!0,movementSpeed:3,width:10,height:10,death:{width:16,height:16,movementSpeed:0,corpse:0,fastAnimation:!0,textures:["images/explosion_1_1.png","images/explosion_1_2.png","images/explosion_1_3.png"]}}},e.exports=i["default"]},{}],12:[function(t,e,i){"use strict";i.__esModule=!0,i["default"]={name:"Cannon Tower",type:"tower",textures:["images/tower_2_1.png"],width:32,height:32,movementSpeed:0,attackSpeed:.3,price:60,range:250,shot:{textures:["images/shot_2.png"],name:"Cannon Tower Shot",damage:30,homing:!1,splash:30,movementSpeed:1.5,width:10,height:10,death:{width:18,height:18,movementSpeed:0,corpse:0,fastAnimation:!0,textures:["images/explosion_2_1.png","images/explosion_2_2.png","images/explosion_2_3.png"]}}},e.exports=i["default"]},{}],13:[function(t,e,i){"use strict";i.__esModule=!0,i["default"]={name:"Grass",textures:["images/grass_3.png"],width:32,height:32},e.exports=i["default"]},{}],14:[function(t,e,i){"use strict";i.__esModule=!0,i["default"]={name:"Ice Tower",type:"tower",textures:["images/tower_3_1.png"],width:32,height:32,movementSpeed:0,attackSpeed:1,price:30,range:100,shot:{textures:["images/shot_3_1.png"],name:"Ice Tower Shot",damage:5,homing:!0,splash:50,movementSpeed:2,width:20,height:20,buff:{type:"debuff",name:"Ice Slow",duration:2e3,textures:["images/ice_debuf.png"],effect:function(t){t.movementSpeed*=.5}},death:{width:32,height:32,movementSpeed:0,corpse:0,fastAnimation:!0,textures:["images/explosion_3_1.png","images/explosion_3_2.png","images/explosion_3_3.png"]}}},e.exports=i["default"]},{}],15:[function(t,e,i){"use strict";function s(t){return t&&t.__esModule?t:{"default":t}}function n(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e["default"]=t,e}function a(t,e){return t&&t.textures?t.textures.map(function(t,i){return[e+"."+i,t]}).concat(a(t.shot,e+".shot")).concat(a(t.death,e+".death")):[]}i.__esModule=!0;var r=t("."),o=n(r),h=t("./grass"),u=s(h);i.grass=u["default"];var l=t("./sand"),c=s(l);i.sand=c["default"];var f=t("./rock"),p=s(f);i.rock=p["default"];var d=t("./spawn"),g=s(d);i.spawn=g["default"];var m=t("./peasant"),w=s(m);i.peasant=w["default"];var y=t("./recruit"),v=s(y);i.recruit=v["default"];var _=t("./arrowTower"),x=s(_);i.arrowTower=x["default"];var b=t("./cannonTower"),T=s(b);i.cannonTower=T["default"];var S=t("./iceTower"),O=s(S);i.iceTower=O["default"];var M=Object.keys(o).reduce(function(t,e){return t.concat(a(o[e],e))},[]);i.assets=M;var A=Object.keys(o).map(function(t){return o[t]}).filter(function(t){return"tower"===t.type});i.towers=A;var P=Object.keys(o).map(function(t){return o[t]}).filter(function(t){return"unit"===t.type});i.units=P},{".":15,"./arrowTower":11,"./cannonTower":12,"./grass":13,"./iceTower":14,"./peasant":16,"./recruit":17,"./rock":18,"./sand":19,"./spawn":20}],16:[function(t,e,i){"use strict";i.__esModule=!0,i["default"]={name:"Peasant",type:"unit",sprite:"images/unit_1.png",width:32,height:32,movementSpeed:.6,bounty:3,health:100,damage:0},e.exports=i["default"]},{}],17:[function(t,e,i){"use strict";i.__esModule=!0,i["default"]={name:"Recruit",type:"unit",textures:["images/unit_1_1.png","images/unit_1_2.png"],width:18,height:32,movementSpeed:.6,bounty:5,health:200,damage:0},e.exports=i["default"]},{}],18:[function(t,e,i){"use strict";i.__esModule=!0,i["default"]={name:"Rock",textures:["images/rock.png"],width:32,height:32},e.exports=i["default"]},{}],19:[function(t,e,i){"use strict";i.__esModule=!0,i["default"]={name:"Sand",textures:["images/sand.png"],width:32,height:32},e.exports=i["default"]},{}],20:[function(t,e,i){"use strict";i.__esModule=!0,i["default"]={name:"Spawn",textures:["images/spawn_1.png","images/spawn_2.png"],width:32,height:32},e.exports=i["default"]},{}]},{},[1]);