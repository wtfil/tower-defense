!function t(e,n,r){function i(a,u){if(!n[a]){if(!e[a]){var s="function"==typeof require&&require;if(!u&&s)return s(a,!0);if(o)return o(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[a]={exports:{}};e[a][0].call(l.exports,function(t){var n=e[a][1][t];return i(n?n:t)},l,l.exports,t,e,n,r)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<r.length;a++)i(r[a]);return i}({1:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function i(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e["default"]=t,e}function o(){return M?setTimeout(o,1e3/60):(E.setTargets(),E.fire(),E.collision(),E.getUnits().forEach(function(t){t.move()}),void setTimeout(o,1e3/60))}function a(){var t={layer:v};f.renderMap(m.map,t),f.renderUnits(E.getUnits(),t),f.renderStats(E.getStats(),t),S&&f.renderCursor(S,u({},t,E.buildAtributes(S,w.get()))),y(a)}var u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},s=t("./maps"),c=t("./objects"),l=i(c),f=t("./core/render"),h=(t("./core/utils"),t("./core/game")),d=r(h),g=t("./core/mouse"),p=r(g),m=(t("./core/constants"),s.getFirst()),y=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){return setTimeout(t,1e3/60)},x=document.querySelector("canvas"),v=x.getContext("2d"),w=p["default"](v),_=Object.keys(l).map(function(t){return l[t]}).filter(function(t){return"tower"===t.type});v.imageSmoothingEnabled=!1,x.width=640,x.height=320;var E=d["default"](m),M=!1,S=null;E.run(),f.renderPanel(document.querySelector("[data-panel]")),document.addEventListener("visibilitychange",function(t){return M=document.hidden}),document.addEventListener("contextmenu",function(t){t.preventDefault(),S=null}),_.forEach(function(t){document.querySelector('[data-tower="'+t.name+'"]').addEventListener("click",function(e){S=t})}),x.addEventListener("click",function(t){var e;if(S){if(e=E.buildAtributes(S,w.get()),!e.alowed)return;E.buildTower(S,e)}}),f.preloadAll(function(){o(),a()})},{"./core/constants":4,"./core/game":5,"./core/mouse":6,"./core/render":7,"./core/utils":8,"./maps":10,"./objects":14}],2:[function(t,e,n){"use strict";function r(t,e){var n=e.x,r=e.y,o=e.target;this.config=t,this.x=n,this.y=r,this.createdAt=Date.now(),this.lastShotAt=0,this.alive=!0,this.health=t.health,this.target=o||null,this.path=null,this.angle=o?i.getAngle(this,o):0}n.__esModule=!0;var i=t("./utils");r.prototype.move=function(){this.config.homing&&this.target?this.angle=i.getAngle(this,this.target):this.path&&(this.angle=i.getAngle(this,this.path[0]),i.round(this.x-this.path[0].x,5)||i.round(this.y-this.path[0].y,5)||(this.path=this.path.slice(1),this.path.length||(this.path=null))),this.x+=this.config.movementSpeed*Math.cos(this.angle),this.y+=this.config.movementSpeed*Math.sin(this.angle)},r.prototype.setPath=function(t){this.path=t},r.prototype.setTarget=function(t){this.target=t},r.prototype.takeDamage=function(t){this.health-=t,this.health<=0&&this.die()},r.prototype.fire=function(){var t=1e3/this.config.attackSpeed,e=Date.now();return this.target&&this.lastShotAt+t<e?(this.lastShotAt=e,!0):null},r.prototype.die=function(){this.alive=!1,this.health=0},n["default"]=r,e.exports=n["default"]},{"./utils":8}],3:[function(t,e,n){"use strict";function r(t,e,n){var i=n[o(e)];return i=i.x===t.x&&i.y===t.y?i:r(t,i,n),[e].concat(i)}function i(t,e,n){for(var i,a,u,s,c,l,f,h,d=[t],g={},p={},m={},y=(i={},i[o(t)]=0,i),x=n[0].length,v=n.length;d.length;){if(u=d.shift(),u.x===e.x&&u.y===e.y)return r(t,e,m).reverse();for(l=o(u),s=y[l],g[l]=!0,f=[{x:u.x-1,y:u.y},{x:u.x+1,y:u.y},{x:u.x,y:u.y-1},{x:u.x,y:u.y+1}],a=0;4>a;a++)h=f[a],l=o(h),p[l]||h.x<0||h.x>=x||h.y<0||h.y>=v||n[h.y][h.x]||(c=s+1,(!(l in y)||c<y[l])&&(y[l]=c,m[l]=u),p[l]=!0,d.push(h))}return null}n.__esModule=!0,n["default"]=i;var o=function(t){return t.x+","+t.y};Math.abs;e.exports=n["default"]},{}],4:[function(t,e,n){"use strict";n.__esModule=!0;var r=32;n.SEGMENT=r},{}],5:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function i(t){function e(t){return{x:Math.floor(t.x/u.SEGMENT),y:Math.floor(t.y/u.SEGMENT)}}function n(){k.forEach(r)}function r(n){var r=c["default"](e(n),t.finish,F).slice(1).map(function(t){return{x:t.x*u.SEGMENT,y:t.y*u.SEGMENT}});n.setPath(r)}function i(t,r){var i=e(r);j.push(new a["default"](t,r)),F[i.y][i.x]=1,D={},b-=t.price,n()}function o(t,e){var n=new a["default"](t,e);k.push(n),r(n)}function s(){return j.concat(k).concat(N).concat(O)}function f(){var t,e,n,r,i,o,a;for(t=0;t<j.length;t++){if(n=j[t],r=n.target){if(l.inRange(n,r))continue;n.setTarget(null)}for(o=1/0,i=null,e=0;e<k.length;e++)r=k[e],a=l.inRangeDiff(n,r),0>a&&o>a&&(i=r,o=a),i&&n.setTarget(i)}}function h(){var t,e;for(t=0;t<j.length;t++)e=j[t],e.fire()&&N.push(new a["default"](e.config.shot,{x:e.x,y:e.y,target:e.target,angle:l.getAngle(e,e.target)}))}function d(){var t,e,n;for(t=0;t<N.length;t++)if(n=N[t],n.config.homing&&n.target&&l.inObject(n,n.target))g(n,n.target);else if(!n.config.homing)for(e=0;e<k.length;e++)if(l.inObject(n,k[e])){g(n,k[e]);break}for(m(),t=0;t<k.length;t++)l.inObject(k[t],G)||(S--,k[t].die());m()}function g(t,e){var n;if(t.config.splash)for(n=0;n<k.length;n++)l.inSplash(t,k[n])&&p(t,k[n]);else p(t,e);t.die(),t.config.death&&O.push(new a["default"](t.config.death,{x:t.x,y:t.y}))}function p(t,e){e.takeDamage(t.config.damage)}function m(){var t,e=Date.now(),n=[];for(t=0;t<k.length;t++)k[t].alive?n.push(k[t]):y(k[t]);N=N.filter(function(t){return t.alive}),O=O.filter(function(t){return t.config.corpse||60*t.config.textures.length+t.createdAt>e}),k=n}function y(t){var e;for(e=0;e<j.length;e++)j[e].target===t&&j[e].setTarget(null);b+=t.config.bounty,A--,A||(M++,setTimeout(w,5e3))}function x(e){var n,r=e.x+","+e.y;return D[r]?D[r]:(n=F.slice(),n[e.y]=F[e.y].slice(),n[e.y][e.x]=1,D[r]=!!c["default"](t.spawn,t.finish,n),D[r])}function v(n,r){var i,o=k.concat(j),a=e(r),s=a.x*u.SEGMENT,c=a.y*u.SEGMENT;if(n.price>b)return{x:s,y:c,alowed:!1};for(i=0;i<o.length;i++)if(l.inObject(r,o[i]))return{x:s,y:c,alowed:!1};return a.x<0||a.x>=t.size.width||a.y<0||a.y>=t.size.height?{x:s,y:c,alowed:!1}:{x:s,y:c,alowed:x(a)}}function w(){function e(){r>=n.count||(o(n.unit,{x:t.spawn.x*u.SEGMENT,y:t.spawn.y*u.SEGMENT}),r++,setTimeout(e,3e3))}if(M>=t.waves.length)return console.log("END GAME");var n=t.waves[M],r=0;A=n.count,e()}function _(){w()}function E(){return{wave:M+1,lives:S,score:T,gold:b,unitsInWave:A}}var M=0,S=t.lives,b=t.gold,T=0,A=0,j=[],k=[],N=[],O=[],G={x:0,y:0,config:{width:t.size.width*u.SEGMENT,height:t.size.height*u.SEGMENT}},F=new Array(t.size.height).join().split(",").map(function(e){return new Array(t.size.width).join().split(",").map(Number)}),D={};return{buildTower:i,addUnit:o,getUnits:s,setTargets:f,fire:h,collision:d,buildAtributes:v,run:_,getStats:E}}n.__esModule=!0,n["default"]=i;var o=t("./Unit"),a=r(o),u=t("./constants"),s=t("./algorithms/astar"),c=r(s),l=t("./utils");e.exports=n["default"]},{"./Unit":2,"./algorithms/astar":3,"./constants":4,"./utils":8}],6:[function(t,e,n){"use strict";n.__esModule=!0,n["default"]=function(t){var e=0,n=0;return t.canvas.addEventListener("mousemove",function(t){e=t.clientX,n=t.clientY}),{get:function(){return{x:e,y:n}}}},e.exports=n["default"]},{}],7:[function(t,e,n){"use strict";function r(t,e){function n(){var e=s/t.health;o.imageSmoothingEnabled=!1,o.drawImage(h,r,i,t.width,t.height),o.globalAlpha=1,"health"in t&&(o.fillStyle="#00FF00",o.fillRect(r,i,t.width,2),o.fillStyle="#FF0000",o.fillRect(r+e*t.width,i,(1-e)*t.width,2))}var r=e.x,i=e.y,o=e.layer,a=e.time,u=void 0===a?0:a,s=e.health,c=t.fastAnimation?g:d,l=~~((Date.now()-u)/c)%t.textures.length,f=t.textures[l],h=m[f];h||(h=m[f]=new Image,h.src=f,h.loads=[],h.onload=function(){h.loads.forEach(function(t){return t()})}),h.complete?n():h.loads.push(n)}function i(t,e){var n=e.layer;t.forEach(function(t,e){t.forEach(function(t,i){var o={x:h.SEGMENT*i,y:h.SEGMENT*e,layer:n};r(t,o)})})}function o(t,e){var n=e.x,i=e.y,o=e.layer,a=e.alowed;o.globalAlpha=.4,o.fillStyle=a?"#00FF00":"#FF0000",o.fillRect(n,i,h.SEGMENT,h.SEGMENT),r(t,{layer:o,x:n,y:i})}function a(t,e){var n=e.layer;t.forEach(function(t){r(t.config,{layer:n,x:t.x,y:t.y,health:t.health,time:t.createdAt})})}function u(t,e){var n=e.layer,r=e.x,i=e.y;n.strokeStyle="black",n.font="16px monaco",n.lineWidth=4,n.strokeText(t,r,i),n.fillStyle="white",n.fillText(t,r,i)}function s(t,e){var n=e.layer;u("wave:  "+t.wave,{x:10,y:20,layer:n}),u("lives: "+t.lives,{x:10,y:40,layer:n}),u("gold:  "+t.gold,{x:10,y:60,layer:n}),u("score: "+t.score,{x:10,y:80,layer:n})}function c(t){Object.keys(p).map(function(t){return p[t]}).filter(function(t){return"tower"===t.type}).forEach(function(e){var n=document.createElement("img");n.src=e.textures[0],n.classList.add("panel-tower"),n.dataset.tower=e.name,n.width=e.width,n.height=e.height,t.appendChild(n)})}function l(t,e){var n=t.reduce(function(t,e){return t.concat(e.textures)},[]).filter(Boolean);Promise.all(n.map(function(t){return new Promise(function(e){var n=new Image;m[t]=n,n.onload=e,n.loads=[],n.src=t})})).then(e)}function f(t){var e=Object.keys(p).map(function(t){return p[t]});return l(e,t)}n.__esModule=!0,n.render=r,n.renderMap=i,n.renderCursor=o,n.renderUnits=a,n.renderStats=s,n.renderPanel=c,n.preload=l,n.preloadAll=f;var h=t("./constants"),d=300,g=60,p=t("../objects"),m=[]},{"../objects":14,"./constants":4}],8:[function(t,e,n){"use strict";function r(t,e){return l(e.x-t.x)+l(e.y-t.y)<l(t.config.range)}function i(t,e){return l(e.x-t.x)+l(e.y-t.y)-l(t.config.range)}function o(t,e){var n=e.x-t.x,r=e.y-t.y,i=Math.atan(r/n);return 0>n&&(i=Math.PI+i),i}function a(t,e){var n=t.config?t.config.width/2:0,r=t.config?t.config.height/2:0;return t.x>=e.x-n&&t.x<e.x+e.config.width+n&&t.y>=e.y-r&&t.y<e.y+e.config.height+r}function u(t,e){return l(t.x-e.x-e.config.width/2)+l(t.y-e.y-e.config.height/2)<l(t.config.splash)}function s(t,e){return Math.round(Math.random()*(e-t))+t}function c(t){var e=arguments.length<=1||void 0===arguments[1]?1:arguments[1];return t-t%e}n.__esModule=!0,n.inRange=r,n.inRangeDiff=i,n.getAngle=o,n.inObject=a,n.inSplash=u,n.random=s,n.round=c;var l=(Math.sqrt,function(t){return t*t})},{}],9:[function(t,e,n){"use strict";n.__esModule=!0,n["default"]={lives:3,gold:100,size:{width:20,height:10},spawn:{x:0,y:5},finish:{x:19,y:5},waves:[[1,3],[1,20]],map:"\n	11111111111111111111\n	11111111111111111111\n	11111111111111111111\n	11111111111111111111\n	11111111111111111111\n	11111111111111111111\n	11111111111111111111\n	11111111111111111111\n	11111111111111111111\n	11111111111111111111\n	"},e.exports=n["default"]},{}],10:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}function i(t){return t.split("\n").filter(Boolean).map(function(t){return t.trim().split("").map(Number).map(function(t){return f[t]})})}function o(t){return t.map(function(t){return{unit:h[t[0]],count:t[1]}})}function a(){var t=c["default"];return u({},t,{map:i(t.map),waves:o(t.waves)})}n.__esModule=!0;var u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t};n.getFirst=a;var s=t("./first"),c=r(s),l=t("../objects"),f={0:l.sand,1:l.grass,2:l.rock},h={1:l.unit}},{"../objects":14,"./first":9}],11:[function(t,e,n){"use strict";n.__esModule=!0,n["default"]={name:"Arrow Tower",type:"tower",textures:["images/tower_1_2.png"],width:32,height:32,movementSpeed:0,attackSpeed:2,price:10,range:250,shot:{textures:["images/shot_1.png"],damage:1,homing:!0,movementSpeed:4,width:10,height:10,death:{width:16,height:16,movementSpeed:0,corpse:0,fastAnimation:!0,textures:["images/explosion_1_1.png","images/explosion_1_2.png","images/explosion_1_3.png"]}}},e.exports=n["default"]},{}],12:[function(t,e,n){"use strict";n.__esModule=!0,n["default"]={name:"Cannon Tower",type:"tower",textures:["images/tower_2_1.png"],width:32,height:32,movementSpeed:0,attackSpeed:.3,price:60,range:250,shot:{textures:["images/shot_2.png"],damage:30,homing:!1,splash:30,movementSpeed:1.5,width:10,height:10,death:{width:18,height:18,movementSpeed:0,corpse:0,fastAnimation:!0,textures:["images/explosion_2_1.png","images/explosion_2_2.png","images/explosion_2_3.png"]}}},e.exports=n["default"]},{}],13:[function(t,e,n){"use strict";n.__esModule=!0,n["default"]={name:"Grass",textures:["images/grass.png"],width:32,height:32},e.exports=n["default"]},{}],14:[function(t,e,n){"use strict";function r(t){return t&&t.__esModule?t:{"default":t}}n.__esModule=!0;var i=t("./grass"),o=r(i);n.grass=o["default"];var a=t("./sand"),u=r(a);n.sand=u["default"];var s=t("./rock"),c=r(s);n.rock=c["default"];var l=t("./arrowTower"),f=r(l);n.arrowTower=f["default"];var h=t("./cannonTower"),d=r(h);n.cannonTower=d["default"];var g=t("./unit"),p=r(g);n.unit=p["default"]},{"./arrowTower":11,"./cannonTower":12,"./grass":13,"./rock":15,"./sand":16,"./unit":17}],15:[function(t,e,n){"use strict";n.__esModule=!0,n["default"]={name:"Rock",textures:["images/rock.png"],width:32,height:32},e.exports=n["default"]},{}],16:[function(t,e,n){"use strict";n.__esModule=!0,n["default"]={name:"Sand",textures:["images/sand.png"],width:32,height:32},e.exports=n["default"]},{}],17:[function(t,e,n){"use strict";n.__esModule=!0,n["default"]={name:"Unit",type:"unit",textures:["images/unit_1_1.png","images/unit_1_2.png"],width:20,height:36,movementSpeed:.6,bounty:3,health:100,damage:0},e.exports=n["default"]},{}]},{},[1]);